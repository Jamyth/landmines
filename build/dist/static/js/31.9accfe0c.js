(self.webpackChunklandmines=self.webpackChunklandmines||[]).push([[31],{8031:function(e,t,r){"use strict";r.r(t),r.d(t,{GameState:function(){return J},MainComponent:function(){return q},TimerState:function(){return F},useGameAction:function(){return Z}});var n,o,l=r(2804),a=r(6237),u=r(7294),i=r(5975),c=function(e){return e(l.default.useRecoilValue(J))},f=r(4096),s=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onGridClick=function(e){var r=t.props,n=r.size,o=r.onClick,l=r.scrollTop,a=Math.floor((e.clientX-e.currentTarget.offsetLeft-e.currentTarget.scrollLeft)/n),u=Math.floor((e.clientY-e.currentTarget.offsetTop+(null!=l?l:e.currentTarget.scrollTop))/n);0===e.buttons&&o(a,u,e)},t}return s(t,e),t.prototype.render=function(){var e=this.props,t=e.source,r=e.children;return u.createElement(f.k,{flexDirection:"column",onClick:this.onGridClick},t.map((function(e,t){return u.createElement(f.k,{key:"row-"+t},e.map((function(e,n){return r(e,n,t)})))})))},t}(u.PureComponent),d=r(9583),v=u.memo((function(e){var t=e.size;return u.createElement(k,{size:t,revealed:!0},u.createElement(d.KBx,null))}));!function(e){e.HAS_MARKER="HAS_MARKER",e.UNCERTAIN="UNCERTAIN"}(o||(o={}));var p=r(1649),y=r(8017),h=u.memo((function(e){var t=e.size,r=e.type,n=r===o.HAS_MARKER?"red.600":r===o.UNCERTAIN?"blue.600":void 0;return u.createElement(k,{size:t},u.createElement(y.xu,{color:n},r===o.HAS_MARKER?u.createElement(p.AS1,null):r===o.UNCERTAIN?u.createElement(d.g_g,null):null))})),E=r(7379),g=u.memo((function(e){var t=e.size,r=e.value;return 0===r?u.createElement(k,{size:t,revealed:!0}):u.createElement(k,{size:t,fontSize:t/1.5,revealed:!0},u.createElement(E.Q,{color:function(){switch(r){case 1:return"green.700";case 2:return"yellow.600";case 3:return"orange.500";case 4:case 5:case 6:case 7:case 8:return"red.600";default:return"black"}}()},r))})),b=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.revealedBorder="1px solid #666",t.unRevealedBorderLight="3px solid #eee",t.unRevealedBorderDark="3px solid #666",t}return b(t,e),t.prototype.render=function(){var e=this.props,t=e.size,r=e.children,n=e.revealed,o=void 0!==n&&n,l=e.fontSize,a=o?this.revealedBorder:this.unRevealedBorderLight,i=o?this.revealedBorder:this.unRevealedBorderDark;return u.createElement(f.k,{justifyContent:"center",alignItems:"center",w:t+"px",h:t+"px",borderTop:a,borderLeft:a,borderRight:i,borderBottom:i,fontSize:(l||t/1.8)+"px"},r)},t.Bomb=v,t.Marker=h,t.Number=g,t}(u.PureComponent),S=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,l=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return a};function C(e){var t=function(r,n){if(void 0===n&&(n=!0),r===e&&n)throw new Error("[util] Object contains some field referencing itself: "+JSON.stringify(e));if(null===r||"object"!=typeof r)return r;if(r instanceof Date)return new Date(r.getTime());if(r instanceof Array)return r.map((function(e){return t(e)}));if(r instanceof Object){var o={};for(var l in r)r.hasOwnProperty(l)&&(o[l]=t(r[l]));return o}return r};return t(e,!1)}function M(e){var t=8===e?8:16;return[Math.floor(Math.random()*t),Math.floor(Math.random()*e)]}function w(e,t,r){return!0===e.map[r][t]}var x=Object.freeze({init:function(e,t){for(var r=8===e?8:16,n=(r-1)*(e-1),o=.15*n,l=null!=t?t:n-Math.floor(Math.random()*o),a=[],u=0;u<e;u++){for(var i=[],c=0;c<r;c++)i.push(!1);a.push(i)}for(var f=0;f<l;f++)for(var s=!1;!s;){u=Math.floor(Math.random()*e),c=Math.floor(Math.random()*r);a[u][c]||(a[u][c]=!0,s=!0)}return{size:e,landmines:l,map:a,markers:{},revealed:[],status:"running"}},reveal:function(e,t,r){var n=t+"."+r,l=C(e),a=l.revealed,u=l.map,i=l.size,c=l.markers,f=l.landmines,s=w(l,t,r),m=0===a.length;if(c[n]===o.HAS_MARKER)return l;if(a.includes(n))return l;if(a.push(n),s&&m){var d=!1;for(u[r][t]=!1;!d;){var v=S(M(i),2),p=v[0],y=v[1];w(l,p,y)||(u[y][p]=!0,d=!0)}return l}return s?(l.status="game-over",l):(a.length+f===u.reduce((function(e,t){return e+t.length}),0)&&(l.status="victory"),l)},placeMarker:function(e,t,r,n){var o=t+"."+r,l=C(e);return n?l.markers[o]=n:delete l.markers[o],l},getNumberOfNearbyMine:function(e,t,r){for(var n=[],o=0;o<3;o++)for(var l=0;l<3;l++)if(1!==l||1!==o)try{w(e,t+o-1,r+l-1)?n.push(!0):n.push(!1)}catch(e){n.push(!1)}return n.filter(Boolean).length}}),z=r(4078),R=u.memo((function(e){var t=e.scrollTop,r=c((function(e){return e.game})),n=c((function(e){return e.selectedMarker})),o=r.size,l=r.map,a=r.revealed,i=r.markers,f=(window.innerWidth-40)/(8===o?8:16),s=Z(),d=s.sweep,v=s.placeMarker;return u.createElement(z.i,{mb:2},u.createElement(m,{source:l,onClick:function(e,t,r){null!==n?v(e,t):d(e,t)},size:f,scrollTop:t},(function(e,t,n){var o=t+"."+n,l=a.includes(o),c=x.getNumberOfNearbyMine(r,t,n),s=i[o];return l?e?u.createElement(k.Bomb,{key:o,size:f}):u.createElement(k.Number,{key:o,size:f,value:c}):s?u.createElement(k.Marker,{size:f,key:o,type:s}):u.createElement(k,{key:o,size:f})})))}));function A(e){return e.toString().padStart(2,"0")}var T=Object.freeze({format:function(e){var t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%60);return[A(t),A(r),A(n)]}}),_=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,l=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return a},O=u.memo((function(e){var t=e.startCount,r=void 0!==t&&t,n=e.value,o=e.setValue,l=void 0!==n&&void 0!==o,a=_(u.useState(0),2),i=a[0],c=a[1],f=_(T.format(l?n:i),3),s=f[0],m=f[1],d=f[2];return u.useEffect((function(){if(r){var e=window.setInterval((function(){c((function(e){var t=e+1;return null==o||o(t),t}))}),1e3);return function(){window.clearInterval(e)}}}),[o,r]),u.createElement(E.Q,{color:"red.600",fontWeight:"bold",fontSize:"2em",backgroundColor:"gray.800",px:2},s,":",m,":",d)})),N=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,l=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return a},j=u.memo((function(){var e=c((function(e){var t;return null===(t=e.game)||void 0===t?void 0:t.landmines})),t=c((function(e){var t;return null===(t=e.game)||void 0===t?void 0:t.revealed})),r=c((function(e){var t;return"running"===(null===(t=e.game)||void 0===t?void 0:t.status)})),n=N(l.default.useRecoilState(F),2),o=n[0],a=n[1],i=c((function(e){var t,r;return Object.keys(null!==(r=null===(t=e.game)||void 0===t?void 0:t.markers)&&void 0!==r?r:{}).length})),s=(0!==(null==t?void 0:t.length)||0!==i)&&r;return u.createElement(z.i,{p:2,alignItems:"center",w:"100%",justifyContent:"space-between",mb:2},u.createElement(f.k,{alignItems:"center",pl:2,backgroundColor:"gray.800",color:"red.600"},u.createElement(d.KBx,{fontSize:"20px"}),u.createElement(E.Q,{fontWeight:"bold",fontSize:"2em",px:2},e)),u.createElement(f.k,{alignItems:"center",pl:2,backgroundColor:"gray.800",color:"red.600"},u.createElement(p.uUf,{fontSize:"20px"}),u.createElement(O,{value:o,setValue:a,startCount:s})))})),I=u.memo((function(e){var t=e.active,r=void 0!==t&&t,n=e.children,o=e.onClick,l=e.color,a="3px solid #eee",i="3px solid #666",c=r?i:a,s=r?a:i;return u.createElement(f.k,{justifyContent:"center",alignItems:"center",borderTop:c,borderLeft:c,borderRight:s,borderBottom:s,p:2,fontSize:"lg",onClick:o,color:l},n)})),B=u.memo((function(){var e=c((function(e){return e.selectedMarker})),t=Z().selectMarker;return u.createElement(z.i,{w:"100%",alignItems:"center",justifyContent:"center",p:2},u.createElement(I,{color:"red.600",active:e===o.HAS_MARKER,onClick:function(){return t(o.HAS_MARKER)}},u.createElement(p.AS1,null)),u.createElement(y.xu,{ml:2}),u.createElement(I,{color:"blue.600",active:e===o.UNCERTAIN,onClick:function(){return t(o.UNCERTAIN)}},u.createElement(d.g_g,null)),u.createElement(y.xu,{ml:2}),u.createElement(I,{color:"gray.600",active:"REMOVE"===e,onClick:function(){return t("REMOVE")}},u.createElement(d.Xm5,null)))})),G=r(9140),H=u.memo((function(e){var t=e.onClose,r=e.title,n=e.children;return u.createElement(G.u_,{isOpen:!0,onClose:t,size:"xs",isCentered:!0},u.createElement(G.ZA,null),u.createElement(G.hz,null,u.createElement(G.xB,null,r),u.createElement(G.ol,null),u.createElement(G.fe,{pb:6},n)))})),K=r(3637),L=r(7093),P=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,l=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return a},U=u.memo((function(){var e=P(u.useState(0),2),t=e[0],r=e[1],n=P(u.useState(t?t.toString():""),2),o=n[0],l=n[1],i=(0,a.useHistory)();return u.createElement(H,{onClose:function(){return i.replace("/lobby")},title:"Select Board Size"},u.createElement(K.I,{value:o,onChange:function(e){l(e.target.value)},onBlur:function(){var e=parseInt(o,10);!Number.isNaN(e)&&e>=16&&e<=36?(r(e),l(e.toString())):l("")},placeholder:"Game Size between 16 - 36"}),u.createElement(f.k,{justifyContent:"center",alignItems:"center",mt:4},u.createElement(L.z,{backgroundColor:"gray.500",color:"white"},"Start Game")))})),V=r(336),D=r(4115),Q=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,l=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return a},W=u.memo((function(e){var t=e.status,r=l.default.useRecoilValue(F),n=c((function(e){return e.level})),o=Z().restartGame,i=Q(T.format(r),3),s=i[0],m=i[1],d=i[2],v="victory"===t,p=(0,a.useHistory)(),h=["easy","medium"].includes(n);return u.createElement(H,{title:v?"Level Complete":"Game Over",onClose:function(){}},u.createElement(V.X,{textAlign:"center",mb:2,size:"lg"},v?"Congratulations":"Oops"),u.createElement(D.x,null,v?"You've found all the landmines !":"You just blown yourself into dust"),u.createElement(D.x,{mt:2},"Time:",u.createElement(y.xu,{ml:2,as:"span",color:"red.600"},s,":",m,":",d)),u.createElement(f.k,{mt:4,justifyContent:"center"},u.createElement(L.z,{backgroundColor:"gray.500",color:"white",onClick:function(){return o(n)}},"Restart Game"),v&&h&&u.createElement(L.z,{ml:3,onClick:function(){if(h){var e="/game";switch(n){case"easy":e="/game/medium";break;case"medium":e="/game/hard"}p.push(e)}},backgroundColor:"gray.500",color:"white"},"Next Level")))})),X=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,l=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return a},Y=u.memo((function(){var e=c((function(e){return e.game})),t=c((function(e){return e.level})),r=X(u.useState(0),2),n=r[0],o=r[1];return u.createElement(i.T,{onScroll:function(e){o(e.currentTarget.scrollTop)}},u.createElement(f.k,{flex:1,flexDirection:"column",justifyContent:"center",alignItems:"center",p:"15px",background:"linear-gradient(-45deg, #eee, #70706f, #eee 60%, #70706f)"},e?u.createElement(u.Fragment,null,u.createElement(j,null),u.createElement(R,{scrollTop:n}),u.createElement(B,null)):null),!e&&"custom"===t&&u.createElement(U,null),e&&"running"!==e.status&&u.createElement(W,{status:e.status}))})),F=l.default.atom({key:"TimerState",default:0}),J=l.default.atom({key:"GameState",default:{game:null,level:null,selectedMarker:null}}),Z=function(){var e=(0,a.useCoilState)(J),t=e.getState,r=e.setState,n=l.default.useSetRecoilState(F),o=function(e){var t=null;switch(e){case"easy":t=x.init(8,10);break;case"medium":t=x.init(16,40);break;case"hard":t=x.init(30,99)}r((function(e){e.game=t})),n(0)};return{restartGame:o,onRouteMatched:function(e){var n=e.level;n!==t().level&&"custom"!==n&&(r((function(e){return e.level=n})),o(n))},sweep:function(e,n){var o=t().game;if(o){var l=x.reveal(o,e,n);r((function(e){return e.game=l}))}},selectMarker:function(e){var n=t().selectedMarker;r(n===e?function(e){return e.selectedMarker=null}:function(t){return t.selectedMarker=e})},placeMarker:function(e,n){var o=t().game,l=t().selectedMarker;if(o){var a=x.placeMarker(o,e,n,"REMOVE"===l?null:l);r((function(e){e.selectedMarker=null,e.game=a}))}}}},q=(0,a.injectLifeCycle)(Y,Z)}}]);